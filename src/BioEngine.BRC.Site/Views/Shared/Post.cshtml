@using System.Globalization
@using BioEngine.BRC.Site.ViewModels
@using BioEngine.Core.Entities
@model BioEngine.Core.Site.Model.PostViewModel
@{
    var dateString = Model.Entity.DateAdded.DateTime.Year == DateTime.Now.Year ? Model.Entity.DateAdded.DateTime.ToString("d MMMM") : Model.Entity.DateAdded.DateTime.ToString("d MMMM yyyy");
}
<article class="card mb-4 post">
    <section class="card-body">
        <header>
            <div class="author">
                <a href="@Model.Entity.Author.ProfileUrl">
                    <img src="@Model.Entity.Author.PhotoUrl" alt="@Model.Entity.Author.Name" class="rounded-circle img-fluid"/> @Model.Entity.Author.Name</a>
                <time datetime="@Model.Entity.DateAdded.DateTime.ToString("s", CultureInfo.InvariantCulture)">@dateString в @Model.Entity.DateAdded.DateTime.ToShortTimeString()</time>
            </div>

            <h2 class="card-title">

                @switch (Model.Mode)
                {
                    case ContentEntityViewMode.List:
                        <a class="article-list__permalink" href="@Model.Entity.PublicUrl">@Model.Entity.Title</a>
                        break;
                    case ContentEntityViewMode.Entity:
                        @Model.Entity.Title
                        break;
                    default:
                        throw new ArgumentOutOfRangeException();
                }
            </h2>
        </header>
        <div class="sections">
            @Html.Raw(string.Join(", ", Model.Entity.Sections.Where(s => s.SiteIds.Contains(Model.Site.Id)).Select(section => $"<a href=\"{section.PublicUrl}\">{section.Title}</a>")))
        </div>
        @{
            await Html.RenderPartialAsync("Blocks/Blocks", Model.ContentEntityViewModel());
        }
    </section>
    <footer class="card-footer">
        @if (Model.Entity.Tags.Any())
        {
            <div class="row tags">
                <div class="col-12">
                    Тэги:
                    @foreach (var tag in Model.Entity.Tags)
                    {
                        @Html.ActionLink(tag.Title, "ListByTagAsync", "Posts", new {tagName = tag.Title})
                        if (tag != Model.Entity.Tags.Last())
                        {
                            <span>, </span>
                        }
                    }
                </div>
            </div>
        }
        <div class="row justify-content-between">
            <div class="col-3">
                @{
                    <a class="btn-sm btn-blue waves-effect waves-light" href="@Model.CommentsUri">
                        <i class="fas fa-comment-alt fa-fw fa-inverse"></i> @Model.CommentsCount</a>
                }
            </div>
            <div class="col-5" style="text-align: right">
                @{
                    var fullUrl = Model.Site.Url + Model.Entity.PublicUrl;
                }
                @await Html.PartialAsync("Share", new ShareViewModel(Model.Entity.Title, fullUrl))
            </div>
        </div>
    </footer>
</article>
